<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Purchase Tracker</title>
<!-- PWA -->
<link href="manifest.json" rel="manifest"/>
<meta content="#1a73e8" name="theme-color"/>
<!-- Google Material Symbols (icons) -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<!-- Styles -->
<link href="style.css" rel="stylesheet"/>
<!-- Chart.js (pinned) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<!-- Google APIs -->
<script src="https://apis.google.com/js/api.js"></script>
<script async="" defer="" src="https://accounts.google.com/gsi/client"></script>
<!-- Content Security Policy (includes all required Google endpoints) -->
<meta content="default-src 'self';
                 script-src 'self' 'unsafe-inline' https://apis.google.com https://accounts.google.com https://cdn.jsdelivr.net https://www.gstatic.com;
                 connect-src https://fcmregistrations.googleapis.com https://fcm.googleapis.com https://firebaseinstallations.googleapis.com https://sheets.googleapis.com https://content-sheets.googleapis.com https://www.googleapis.com https://accounts.google.com https://oauth2.googleapis.com;
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src https://fonts.gstatic.com;
                 frame-src 'self' https://accounts.google.com https://apis.google.com https://content-sheets.googleapis.com;
                 child-src 'self' https://accounts.google.com https://apis.google.com https://content-sheets.googleapis.com;
                 base-uri 'self';
                 frame-ancestors 'self';" http-equiv="Content-Security-Policy"/>
</head>
<body>
<!-- Top app bar -->
<header class="appbar">
<button aria-label="Menu" class="icon-btn" onclick="toggleMenu()">
<span class="material-symbols-outlined">menu</span>
</button>
<h1>Purchase Tracker</h1>
<button class="btn text-on-primary" id="googleSignInBtn" onclick="googleSignIn()">
<span class="material-symbols-outlined">login</span>
<span>Sign in</span>
</button>
</header>
<!-- Side (hamburger) menu -->
<nav aria-hidden="true" class="side-menu" id="sideMenu">
<div class="menu-header">
<strong>Menu</strong>
<button aria-label="Close" class="icon-btn" onclick="toggleMenu()">
<span class="material-symbols-outlined">close</span>
</button>
</div>
<ul>
<li>
<button class="menu-link" onclick="goPage('home'); toggleMenu();">
<span class="material-symbols-outlined">home</span>
          Home
        </button>
</li>
<li>
<button class="menu-link" onclick="goPage('purchases'); toggleMenu();">
<span class="material-symbols-outlined">receipt_long</span>
          Purchases
        </button>
</li>
<li>
<button class="menu-link danger" onclick="signOutAndClear();">
<span class="material-symbols-outlined">logout</span>
          Sign out &amp; clear this device
        </button>
</li>
</ul>
</nav>
<!-- HOME PAGE -->
<main class="page active" id="page-home">
<section class="card">
<h3>Add purchase</h3>
<div class="input-grid">
<input id="itemName" placeholder="Item name" type="text"/>
<input id="itemAmount" placeholder="Amount" step="0.01" type="number"/>
<input id="itemDate" type="date"/>
</div>
<div class="actions">
<button class="btn primary" onclick="addPurchase()">
<span class="material-symbols-outlined">add</span>
<span>Add Purchase</span>
</button>
<button class="btn danger" onclick="clearPurchases()">
<span class="material-symbols-outlined">delete_sweep</span>
<span>Clear All (local)</span>
</button>
</div>
<!-- If sheet creation ever fails, this appears -->
<div class="status" id="sheetHelper" style="display:none;">
        Couldnâ€™t create your Google Sheet automatically.
        <button class="btn primary" onclick="manualCreateSheet()">Create My Sheet</button>
</div>
<div class="status" id="syncStatus">Not synced yet</div>
</section>
<section class="card">
<h3>Spending burn-up</h3>
<canvas id="burnupChart"></canvas>
</section>
</main>
<!-- PURCHASES PAGE -->
<main class="page" id="page-purchases">
<section class="card">
<h3>Purchases</h3>
<div class="purchase-list" id="purchaseList"></div>
</section>
</main>
<!-- Footer total -->
<footer class="total" id="totalSpent">Total: $0.00</footer>
<!-- App logic -->
<script src="script.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-messaging-compat.js"></script>
<!-- Service worker registration -->
<script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker
    .register('/purchase-tracker/service-worker.js', { scope: '/purchase-tracker/' })
    .then(() => { console.log('Service worker registered for /purchase-tracker/'); })
    .catch((err) => { console.error('Service worker registration failed:', err); });
}
</script>
</body>
</html>
